<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KGBaby v0.3 - Secure Audio Monitor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;700;800&family=Sora:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body>
    <div id="app">
        <div id="landing-screen" class="screen">
            <section class="hero-card">
                <p class="eyebrow">Private audio baby monitor</p>
                <h1>KGBaby v0.3</h1>
                <p class="hero-copy">One tap to pair devices, then monitor with low-latency audio, white noise controls, and calm infant state updates.</p>
            </section>

            <section class="setup-card">
                <p class="section-title">Choose this device</p>
                <div class="role-selection">
                    <button id="btn-child" class="btn-large" type="button">
                        <span class="icon" aria-hidden="true">ðŸ‘¶</span>
                        <span class="role-title">Child Unit</span>
                        <span class="role-meta">Mic in nursery</span>
                    </button>
                    <button id="btn-parent" class="btn-large" type="button">
                        <span class="icon" aria-hidden="true">ðŸŽ§</span>
                        <span class="role-title">Parent Unit</span>
                        <span class="role-meta">Live listening</span>
                    </button>
                </div>

                <div class="room-input-container">
                    <label for="room-id">Join Code</label>
                    <input type="text" id="room-id" placeholder="e.g. OTTER-AB12-CD34" autocapitalize="characters">
                    <p class="hint">Use the same join code on both devices. Child can generate one.</p>
                    <div id="join-code-actions" class="join-code-actions hidden">
                        <button id="btn-copy-code" class="btn-secondary btn-inline" type="button">Copy Code</button>
                        <button id="btn-new-code" class="btn-secondary btn-inline" type="button">New Code</button>
                    </div>
                </div>

                <div class="room-input-container">
                    <label for="baby-name">Baby Name (Optional)</label>
                    <input type="text" id="baby-name" placeholder="e.g. Samay" autocapitalize="words">
                    <p class="hint">Used only on this device for friendly labels.</p>
                </div>

                <button id="btn-connect" class="btn-primary" disabled>Connect</button>
            </section>

            <div id="debug-log" class="debug-log"></div>
        </div>

        <div id="monitor-screen" class="screen hidden">
            <header class="monitor-header">
                <div class="header-left">
                    <p class="app-version">KGBaby v0.3</p>
                    <h2 id="role-display">Role</h2>
                    <div id="state-summary" class="state-line hidden">Baby state: ðŸ˜´ Zzz</div>
                </div>
                <div class="status-wrap">
                    <div id="connection-status" class="status-indicator disconnected"></div>
                    <div id="status-text" class="status-text">Disconnected Â· Code: --</div>
                </div>
            </header>

            <main class="monitor-main">
                <div id="child-controls" class="hidden role-stack">
                    <section class="surface-card">
                        <div id="vad-status" class="status-message">Microphone Active</div>
                        <div id="white-noise-status" class="white-noise-status hidden">
                            White noise active <span id="white-noise-remaining" class="white-noise-remaining"></span>
                        </div>
                        <button id="white-noise-cta" class="btn-secondary hidden" type="button">Tap to enable white noise</button>
                    </section>

                    <section class="surface-card">
                        <p class="card-label">Baby activity</p>
                        <div class="visualizer-container">
                            <div id="child-db-meter" class="meter-background">
                                <div id="child-db-level" class="meter-fill"></div>
                            </div>
                        </div>
                        <p class="hint">Controls are available from the Parent Unit.</p>
                    </section>
                </div>

                <div id="parent-controls" class="hidden role-stack">
                    <section class="surface-card">
                        <p class="card-label">Live monitor</p>
                        <div class="visualizer-container">
                            <div id="parent-db-meter" class="meter-background">
                                <div id="parent-db-level" class="meter-fill"></div>
                            </div>
                        </div>
                        <div id="audio-status">Waiting for audio...</div>
                        <button id="btn-listen" class="btn-primary">Start Listening</button>
                        <button id="btn-ack-alarm" class="btn-danger hidden" type="button">I Checked The Baby</button>
                    </section>

                    <section class="surface-card control-group compact-card">
                        <p class="card-label">Comfort controls</p>
                        <div class="action-row">
                            <button id="white-noise-toggle" class="btn-secondary btn-inline" type="button">Start White Noise</button>
                            <button id="btn-dim-parent" class="btn-secondary btn-inline" type="button">Dim Child Screen</button>
                        </div>
                        <label>Custom shush loop</label>
                        <div class="action-row">
                            <button id="btn-record-shush" class="btn-secondary btn-inline" type="button">Record 10s Shush</button>
                            <button id="btn-toggle-shush" class="btn-secondary btn-inline" type="button" disabled>Use Recorded Shush: Off</button>
                        </div>
                        <button id="btn-clear-shush" class="btn-secondary btn-inline" type="button" disabled>Delete Recorded Shush</button>
                        <div id="shush-status" class="hint">No custom shush recorded.</div>
                        <label for="white-noise-volume">Volume</label>
                        <input id="white-noise-volume" type="range" min="0" max="100" value="50">
                        <label for="white-noise-timer">Timer</label>
                        <select id="white-noise-timer">
                            <option value="1800000">30 min</option>
                            <option value="3600000">60 min</option>
                            <option value="infinite" selected>Infinite</option>
                        </select>
                    </section>

                    <audio id="remote-audio" autoplay playsinline style="display:none;" muted></audio>
                </div>
            </main>

            <audio id="white-noise-audio" preload="auto" loop playsinline style="display:none;">
                <source src="assets/audio/white-noise.mp3" type="audio/mpeg">
            </audio>

            <footer>
                <button id="btn-stop" class="btn-danger">Stop & Exit</button>
            </footer>
        </div>

        <div id="dim-overlay" class="hidden">
            <p>Double-tap to wake</p>
        </div>

        <video id="wake-lock-video" playsinline loop muted width="1" height="1" style="opacity: 0; pointer-events: none; position: absolute;">
            <source src="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAC5tZGF0DQoAAAAADGdmZDL3AgAAAAAAB5ZtZnJhAAAAAAAAAAH3bWZoZAAAAAB3d3d3AAAAAAA=" type="video/mp4">
        </video>
    </div>

    <script type="module" src="main.js"></script>
</body>
</html>
