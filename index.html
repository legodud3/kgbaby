<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KGBaby v0.1 - Secure Audio Monitor</title>
    <link rel="stylesheet" href="style.css">
    <!-- PeerJS CDN -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Landing Screen: Role Selection -->
        <div id="landing-screen" class="screen">
            <h1>KGBaby v0.1</h1>
            <p>Select your device role</p>
            
            <div class="role-selection">
                <button id="btn-child" class="btn-large">
                    <span class="icon">ðŸ‘¶</span>
                    Child Unit
                </button>
                <button id="btn-parent" class="btn-large">
                    <span class="icon">ðŸ‘‚</span>
                    Parent Unit
                </button>
            </div>

            <div class="room-input-container">
                <label for="room-id">Room Name</label>
                <input type="text" id="room-id" placeholder="e.g. cabin123" autocapitalize="none">
                <p class="hint">Enter the same room name on both devices.</p>
            </div>

            <button id="btn-connect" class="btn-primary" disabled>Connect</button>
            
            <div id="debug-log" style="color: #ff5252; margin-top: 10px; font-size: 0.9rem; min-height: 20px;"></div>
        </div>

        <!-- Monitor Screen: Active Session -->
        <div id="monitor-screen" class="screen hidden">
            <header>
                <div class="header-left">
                    <div class="app-version">KGBaby v0.1</div>
                    <h2 id="role-display">Role</h2>
                    <div id="last-cry" class="last-cry hidden">Last cry: --</div>
                </div>
                <div class="status-wrap">
                    <div id="connection-status" class="status-indicator disconnected"></div>
                    <div id="status-text" class="status-text">Disconnected Â· Room: --</div>
                </div>
            </header>

            <main>
                <!-- Child View Elements -->
                <div id="child-controls" class="hidden">
                    <div id="vad-status" class="status-message">Microphone Active</div>
                    <div id="white-noise-status" class="white-noise-status hidden">
                        White Noise Active <span id="white-noise-remaining" class="white-noise-remaining"></span>
                    </div>
                    <button id="white-noise-cta" class="btn-secondary hidden" type="button">Tap to enable white noise</button>
                    
                    <!-- Unified Visualizer (Same as Parent) -->
                    <div class="visualizer-container">
                        <div id="child-db-meter" class="meter-background">
                            <div id="child-db-level" class="meter-fill"></div>
                        </div>
                    </div>
                    
                    <div class="hint">Controls are on the Parent unit.</div>
                </div>

                <!-- Parent View Elements -->
                <div id="parent-controls" class="hidden">
                    <div class="visualizer-container">
                        <div id="parent-db-meter" class="meter-background">
                            <div id="parent-db-level" class="meter-fill"></div>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label>Mode</label>
                        <div class="segmented">
                            <button id="mode-transparency" class="seg-btn active" type="button">Transparency</button>
                            <button id="mode-minimal" class="seg-btn" type="button">Minimal</button>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>White Noise</label>
                        <button id="white-noise-toggle" class="btn-secondary" type="button">Start White Noise</button>
                        <label for="white-noise-volume">Volume</label>
                        <input id="white-noise-volume" type="range" min="0" max="100" value="50">
                        <label for="white-noise-timer">Timer</label>
                        <select id="white-noise-timer">
                            <option value="1800000">30 min</option>
                            <option value="3600000">60 min</option>
                            <option value="infinite" selected>Infinite</option>
                        </select>
                    </div>

                    <button id="btn-dim-parent" class="btn-secondary" type="button">Dim Child Screen</button>

                    <audio id="remote-audio" autoplay playsinline style="display:none;" muted></audio>
                    <button id="btn-listen" class="btn-primary">Start Listening</button>
                    <div id="audio-status">Waiting for audio...</div>
                </div>
            </main>
            
            <audio id="white-noise-audio" preload="auto" loop playsinline style="display:none;">
                <source src="assets/audio/white-noise.mp3" type="audio/mpeg">
            </audio>

            <footer>
                <button id="btn-stop" class="btn-danger">Stop & Exit</button>
            </footer>
        </div>
        
        <!-- Dim Overlay for Child Unit -->
        <div id="dim-overlay" class="hidden">
            <p>Double-tap to wake</p>
        </div>
        
        <!-- IOS WAKE LOCK HACK: Hidden video loop to keep browser/network active -->
        <video id="wake-lock-video" playsinline loop muted width="1" height="1" style="opacity: 0; pointer-events: none; position: absolute;">
            <source src="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAC5tZGF0DQoAAAAADGdmZDL3AgAAAAAAB5ZtZnJhAAAAAAAAAAH3bWZoZAAAAAB3d3d3AAAAAAA=" type="video/mp4">
        </video>
    </div>
    
    <script src="cry-config.js"></script>
    <script src="network-config.js"></script>
    <script src="script.js"></script>
</body>
</html>
